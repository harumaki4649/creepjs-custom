<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<link rel="icon" href="favicon.ico">
	<link rel="stylesheet" href="style.min.css">
	<script src="creep.js" defer></script>
	<title>CreepJS</title>
</head>

<body>
	<div id="fp-app">
		<fingerprint>
			<div id="fingerprint-data">
				<div class="fingerprint-header-container">
					<div class="fingerprint-header">
						<div class="ellipsis-all">FP ID: Computing...</div>
						<div id="fuzzy-fingerprint">
							<div class="ellipsis-all fuzzy-fp">Fuzzy: <span
									class="blurred">0000000000000000000000000000000000000000000000000000000000000000</span></div>
						</div>
						<div><span class="time">0 ms</span></div>
					</div>
				</div>
				<div class="flex-grid hidden">
					<div class="col-six">
						<strong>WebRTC</strong>
						<div>host connection:</div>
						<div class="block-text"></div>
						<div>foundation/ip:</div>
						<div class="block-text"></div>
					</div>
					<div class="col-six">
						<div>sdp capabilities:</div>
						<div>stun connection:</div>
						<div class="block-text"></div>
						<div>devices (0):</div>
						<div class="block-text"></div>
					</div>
				</div>
				<div class="flex-grid hidden">
					<div class="col-six">
						<strong>Timezone</strong>
						<div class="block-text"></div>
					</div>
					<div class="col-six">
						<strong>Intl</strong>
						<div class="block-text"></div>
					</div>
				</div>
				<div id="headless-resistance-detection" class="flex-grid hidden">
					<div class="col-six">
						<strong>Headless</strong>
						<div>chromium:</div>
						<div>0% like headless:</div>
						<div>0% headless:</div>
						<div>0% stealth:</div>
						<div>platform hints:</div>
						<div class="block-text"></div>
					</div>
					<div class="col-six">
						<strong>Resistance</strong>
						<div>privacy:</div>
						<div>security:</div>
						<div>mode:</div>
						<div>extension:</div>
					</div>
				</div>
				<div class="flex-grid hidden">
					<div class="col-six">
						<strong>Worker</strong>
						<div>lang/timezone:</div>
						<div class="block-text"></div>
						<div>gpu:</div>
						<div class="block-text"></div>
					</div>
					<div class="col-six">
						<div>userAgent:</div>
						<div class="block-text"></div>
						<div>device:</div>
						<div class="block-text"></div>
						<div>userAgentData:</div>
						<div class="block-text"></div>
					</div>
				</div>
				<div class="flex-grid hidden">
					<div class="col-six">
						<strong>WebGL</strong>
						<div>images:</div>
						<div>pixels:</div>
						<div>params (0):</div>
						<div>exts (0):</div>
						<div>gpu:</div>
						<div class="block-text"></div>
						<image class="gl-image" />
					</div>
					<div class="col-six">
						<strong>Screen</strong>
						<div>...screen:</div>
						<div>....avail:</div>
						<div>touch:</div>
						<div>depth:</div>
						<div>viewport:</div>
						<div class="screen-container"></div>
					</div>
				</div>
				<div class="flex-grid hidden">
					<div class="col-six">
						<strong>Canvas 2d</strong>
						<div>data:</div>
						<div>rendering:</div>
						<div class="icon-pixel-container pixels"></div>
						<div class="icon-pixel-container pixels"></div>
						<div>textMetrics:</div>
						<div class="block-text"></div>
					</div>
					<div class="col-six">
						<strong>Fonts</strong>
						<div>load (0):</div>
						<div>apps:</div>
						<div class="block-text-large"></div>
						<div class="block-text"></div>
					</div>
				</div>
				<div class="flex-grid hidden">
					<div class="col-six">
						<strong>DOMRect</strong>
						<div>elems A:</div>
						<div>elems B:</div>
						<div>range A:</div>
						<div>range B:</div>
						<div class="block-text"></div>
					</div>
					<div class="col-six">
						<strong>SVGRect</strong>
						<div>bBox:</div>
						<div>char:</div>
						<div>subs:</div>
						<div>text:</div>
						<div class="block-text"></div>
					</div>
				</div>
				<div class="flex-grid hidden">
					<div class="col-four">
						<strong>Audio</strong>
						<div>sum:</div>
						<div>gain:</div>
						<div>freq:</div>
						<div>time:</div>
						<div>trap:</div>
						<div>unique:</div>
						<div>data:</div>
						<div>copy:</div>
						<div>values:</div>
					</div>
					<div class="col-four">
						<strong>Speech</strong>
						<div>local (0):</div>
						<div>remote (0):</div>
						<div>lang (0):</div>
						<div>default:</div>
						<div class="block-text"></div>
					</div>
					<div class="col-four">
						<strong>Media</strong>
						<div>mimes (0):</div>
						<div>devices (0):</div>
						<div class="block-text"></div>
					</div>
				</div>
				<div class="flex-grid hidden">
					<div class="col-six">
						<div>Features:</div>
						<div>JS/DOM:</div>
					</div>
					<div class="col-six">
						<div>CSS:</div>
						<div>Window:</div>
					</div>
				</div>
				<div class="flex-grid hidden">
					<div class="col-six">
						<strong>CSS Media Queries</strong>
						<div>@media:</div>
						<div>matchMedia:</div>
						<div>touch device:</div>
						<div>screen query:</div>
					</div>
					<div class="col-six">
						<strong>Computed Style</strong>
						<div>keys (0):</div>
						<div>system styles:</div>
						<div>
							<div>system</div>
						</div>
						<div class="gradient"></div>
					</div>
				</div>
				<div class="hidden">
					<div class="flex-grid">
						<div class="col-six">
							<strong>Math</strong>
							<div>results:</div>
							<div>
								<div>0% of engine</div>
							</div>

						</div>
						<div class="col-six">
							<strong>Error</strong>
							<div>results:</div>
							<div>
								<div>0% of engine</div>
							</div>
						</div>
					</div>
					<div class="flex-grid">
						<div class="col-six">
							<strong>Window</strong>
							<div>keys (0):</div>
							<div>
								<div>0% of version</div>
							</div>
						</div>
						<div class="col-six">
							<strong>HTMLElement</strong>
							<div>keys (0):</div>
							<div>
								<div>0% engine</div>
							</div>
						</div>
					</div>
				</div>
				<div class="flex-grid hidden">
					<div class="col-six">
						<strong>Navigator</strong>
						<div>properties (0):</div>
						<div>dnt:</div>
						<div>gpc:</div>
						<div>lang:</div>
						<div>mimeTypes (0):</div>
						<div>permissions (0):</div>
						<div>plugins (0):</div>
						<div>vendor:</div>
						<div>webgpu:</div>
						<div>userAgentData:</div>
						<div class="block-text"></div>
					</div>
					<div class="col-six">
						<div>device:</div>
						<div class="block-text"></div>
						<div>ua parsed:</div>
						<div>userAgent:</div>
						<div class="block-text"></div>
						<div>appVersion:</div>
						<div class="block-text"></div>
					</div>
				</div>
				<div class="flex-grid hidden">
					<div class="col-four">
						<strong>Status</strong>
						<div>network:</div>
						<div class="block-text"></div>
					</div>
					<div class="col-four">
						<div>battery:</div>
						<div class="block-text-large"></div>
					</div>
					<div class="col-four">
						<div>available:</div>
						<div class="block-text-large"></div>
					</div>
				</div>
				<div class="hidden">
					<strong>Tests</strong>
					<div>
						<a class="tests" href="./tests/workers.html">Workers</a>
						<br><a class="tests" href="./tests/iframes.html">Iframes</a>
						<br><a class="tests" href="./tests/fonts.html">Fonts</a>
						<br><a class="tests" href="./tests/timezone.html">Timezone</a>
						<br><a class="tests" href="./tests/window.html">Window Version</a>
						<br><a class="tests" href="./tests/screen.html">Screen</a>
						<br><a class="tests" href="./tests/prototype.html">Prototype</a>
						<br><a class="tests" href="./tests/domrect.html">DOMRect</a>
						<br><a class="tests" href="./tests/emojis.html">Emojis</a>
						<br><a class="tests" href="./tests/math.html">Math</a>
						<br><a class="tests" href="./tests/machine.html">Machine</a>
						<br><a class="tests" href="./tests/extensions.html">Chrome Extensions</a>
						<br><a class="tests" href="./tests/proxy.html">JS Proxy</a>
					</div>
				</div>
			</div>
		</fingerprint>
	</div>
	<script>
// CreepJSの処理完了を監視
function waitForCreepJSComplete() {
    return new Promise((resolve) => {
        const checkInterval = setInterval(() => {
            // FP IDが計算完了しているか確認
            const fpHeader = document.querySelector('.fingerprint-header-container .ellipsis-all');
            if (fpHeader && !fpHeader.textContent.includes('Computing')) {
                clearInterval(checkInterval);
                resolve();
            }
        }, 100);
        
        // 最大30秒でタイムアウト
        setTimeout(() => {
            clearInterval(checkInterval);
            resolve();
        }, 30000);
    });
}

// データ収集関数
async function collectCreepJSData() {
    await waitForCreepJSComplete();
    
    const data = {
        // FP ID
        fingerprintId: document.querySelector('.fingerprint-header-container .ellipsis-all')?.textContent?.replace('FP ID: ', '').trim(),
        
        // Fuzzy FP
        fuzzyFingerprint: document.querySelector('.fuzzy-fp span')?.textContent?.trim(),
        
        // 処理時間
        processingTime: document.querySelector('.time')?.textContent?.trim(),
        
        // Headless検出
        headless: {
            chromium: document.querySelector('#headless-resistance-detection .col-six:first-child')?.textContent?.match(/chromium:\s*(.+)/)?.[1]?.trim(),
            likeHeadless: document.querySelector('#headless-resistance-detection .col-six:first-child')?.textContent?.match(/like headless:\s*(.+)/)?.[1]?.trim(),
            headlessPercent: document.querySelector('#headless-resistance-detection .col-six:first-child')?.textContent?.match(/headless:\s*(.+)/)?.[1]?.trim(),
            stealth: document.querySelector('#headless-resistance-detection .col-six:first-child')?.textContent?.match(/stealth:\s*(.+)/)?.[1]?.trim()
        },
        
        // Resistance検出
        resistance: {
            privacy: document.querySelector('#headless-resistance-detection .col-six:last-child')?.textContent?.match(/privacy:\s*(.+)/)?.[1]?.trim(),
            security: document.querySelector('#headless-resistance-detection .col-six:last-child')?.textContent?.match(/security:\s*(.+)/)?.[1]?.trim(),
            mode: document.querySelector('#headless-resistance-detection .col-six:last-child')?.textContent?.match(/mode:\s*(.+)/)?.[1]?.trim(),
            extension: document.querySelector('#headless-resistance-detection .col-six:last-child')?.textContent?.match(/extension:\s*(.+)/)?.[1]?.trim()
        },
        
        // ブラウザ情報
        userAgent: document.querySelector('.block-text')?.textContent?.trim(),
        
        // 全HTMLを送信（オプション）
        fullHTML: document.getElementById('fingerprint-data')?.innerHTML
    };
    
    return data;
}

// ページロード後にデータを送信
window.addEventListener('load', async () => {
    try {
        const data = await collectCreepJSData();
        
        // 親ページにデータを送信
        window.parent.postMessage({
            type: 'creepjs-result',
            data: data,
            timestamp: Date.now()
        }, '*'); // 本番環境では '*' を特定のオリジンに変更してください
        
        console.log('CreepJS data sent to parent:', data);
    } catch (error) {
        console.error('Error collecting CreepJS data:', error);
        window.parent.postMessage({
            type: 'creepjs-error',
            error: error.message
        }, '*');
    }
});
</script>
</body>
</html>
